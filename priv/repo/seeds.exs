alias TartuParking.{Repo,Parking,User, Zone, DataParser}

zone_a_data = Poison.decode! '{"type":"FeatureCollection","features":[{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[26.7155421,58.3786729,0],[26.7156547,58.3786659,0],[26.7159605,58.378957,0],[26.7164808,58.3793451,0],[26.7167598,58.3793873,0],[26.7208904,58.3801776,0],[26.7208716,58.3802381,0],[26.7176234,58.3796348,0],[26.7164218,58.3793929,0],[26.7157513,58.3788782,0],[26.7155421,58.3786729,0]]]},"properties":{"name":"Lossi","styleUrl":"#poly-0288D1-1200-76-nodesc","styleHash":"-23149281","styleMapHash":{"normal":"#poly-0288D1-1200-76-nodesc-normal","highlight":"#poly-0288D1-1200-76-nodesc-highlight"},"stroke":"#0288d1","stroke-opacity":1,"stroke-width":1.2,"fill":"#0288d1","fill-opacity":0.2980392156862745}},{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[26.7155844,58.378714,0],[26.7150727,58.3787334,0],[26.7134848,58.3788628,0],[26.7126828,58.3789457,0],[26.7125461,58.3789865,0],[26.712487,58.379047,0],[26.7124763,58.3791525,0],[26.712538,58.3792804,0],[26.7126909,58.3796376,0],[26.7128223,58.3797501,0],[26.7129457,58.3799948,0],[26.7129564,58.3801523,0],[26.7129403,58.3803435,0],[26.712817,58.3807148,0],[26.7126292,58.3810973,0],[26.7125756,58.3813701,0],[26.7127311,58.3814994,0],[26.7129296,58.3815923,0],[26.7133802,58.3817694,0],[26.7140561,58.3820057,0],[26.7142439,58.3821153,0],[26.7145228,58.3824163,0],[26.714437,58.3824416,0],[26.714142,58.3821238,0],[26.7137128,58.3819438,0],[26.7130584,58.3817047,0],[26.7128438,58.3816204,0],[26.7126399,58.3815107,0],[26.7125058,58.3813954,0],[26.7125112,58.3812491,0],[26.7125863,58.3809876,0],[26.7127579,58.380622,0],[26.712876,58.3802367,0],[26.7128491,58.3800257,0],[26.7127258,58.3797586,0],[26.7126077,58.3796376,0],[26.7124093,58.379227,0],[26.7123985,58.3790526,0],[26.7125273,58.3789429,0],[26.7128062,58.3788839,0],[26.7135546,58.3788178,0],[26.7150539,58.3786968,0],[26.7155421,58.3786729,0],[26.7155844,58.378714,0]]]},"properties":{"name":"Karl Ernst von Baeri","styleUrl":"#poly-0288D1-1200-76-nodesc","styleHash":"-23149281","styleMapHash":{"normal":"#poly-0288D1-1200-76-nodesc-normal","highlight":"#poly-0288D1-1200-76-nodesc-highlight"},"stroke":"#0288d1","stroke-opacity":1,"stroke-width":1.2,"fill":"#0288d1","fill-opacity":0.2980392156862745}},{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[26.7156547,58.3786659,0],[26.7161858,58.3783621,0],[26.7164835,58.3781723,0],[26.7167383,58.377981,0],[26.7170978,58.3777222,0],[26.7172319,58.3776435,0],[26.7173606,58.3776069,0],[26.7175055,58.3776097,0],[26.7176986,58.3776407,0],[26.7182779,58.3777785,0],[26.7188466,58.3779219,0],[26.7192113,58.3779782,0],[26.719721,58.3780429,0],[26.7202896,58.3780738,0],[26.72059,58.3780654,0],[26.7210406,58.378012,0],[26.7220545,58.3778966,0],[26.7222583,58.3778882,0],[26.7224246,58.377891,0],[26.7225051,58.3779191,0],[26.7225909,58.3779613,0],[26.7228162,58.3781441,0],[26.7232132,58.3784142,0],[26.7231488,58.3784592,0],[26.7227089,58.378147,0],[26.7225158,58.3779866,0],[26.7224246,58.3779529,0],[26.7222798,58.3779388,0],[26.7220062,58.3779529,0],[26.7209548,58.3780682,0],[26.7205685,58.3781104,0],[26.7202199,58.3781104,0],[26.7197371,58.3780879,0],[26.7188948,58.3779838,0],[26.7176181,58.3776829,0],[26.7175055,58.3776632,0],[26.7174196,58.3776547,0],[26.7172909,58.3776885,0],[26.7165399,58.3782088,0],[26.7156926,58.3787025,0],[26.7156547,58.3786659,0]]]},"properties":{"name":"Vallikraavi","styleUrl":"#poly-0288D1-1200-76-nodesc","styleHash":"-23149281","styleMapHash":{"normal":"#poly-0288D1-1200-76-nodesc-normal","highlight":"#poly-0288D1-1200-76-nodesc-highlight"},"stroke":"#0288d1","stroke-opacity":1,"stroke-width":1.2,"fill":"#0288d1","fill-opacity":0.2980392156862745}}]}'
zone_a_parkings = Map.get(zone_a_data, "features")


zone_b_data = Poison.decode! '{"type":"FeatureCollection","features":[{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[26.7135546,58.3788178,0],[26.7134178,58.3787685,0],[26.7132407,58.3787095,0],[26.7129135,58.378597,0],[26.712833,58.3785492,0],[26.7127687,58.378507,0],[26.7127579,58.3784732,0],[26.7123234,58.3783832,0],[26.7119265,58.3782988,0],[26.7115617,58.3782088,0],[26.7111245,58.3781139,0],[26.7109394,58.3780682,0],[26.7109662,58.3780401,0],[26.7112975,58.3781104,0],[26.7118299,58.3782285,0],[26.7123663,58.3783438,0],[26.712876,58.3784479,0],[26.71323,58.3785098,0],[26.7135358,58.3785463,0],[26.7138898,58.3785407,0],[26.7141849,58.3785295,0],[26.7145591,58.3785225,0],[26.7149252,58.3785154,0],[26.7152322,58.3785105,0],[26.7153664,58.3785372,0],[26.7154831,58.3785745,0],[26.7156547,58.3786659,0],[26.7155421,58.3786729,0],[26.7154455,58.3786279,0],[26.7154026,58.378604,0],[26.715353,58.3785808,0],[26.7152872,58.3785653,0],[26.7152148,58.3785492,0],[26.7148179,58.3785604,0],[26.7142332,58.3785717,0],[26.713627,58.3785885,0],[26.7135143,58.3785885,0],[26.713407,58.3785829,0],[26.7128599,58.3784957,0],[26.712935,58.3785576,0],[26.7131335,58.3786251,0],[26.7134285,58.3787179,0],[26.7136846,58.3788079,0],[26.7135546,58.3788178,0]]]},"properties":{"name":"Juhan Liivi","styleUrl":"#poly-FFEA00-1200-76-nodesc","styleHash":"6199a798","styleMapHash":{"normal":"#poly-FFEA00-1200-76-nodesc-normal","highlight":"#poly-FFEA00-1200-76-nodesc-highlight"},"stroke":"#ffea00","stroke-opacity":1,"stroke-width":1.2,"fill":"#ffea00","fill-opacity":0.2980392156862745}}]}'
zone_b_parkings = Map.get(zone_b_data, "features")

[
  %{name: "Zone A", price_per_hour: 2.0, price_per_min: 0.12, free_time: 15},
  %{name: "Zone B", price_per_hour: 1.0, price_per_min: 0.08, free_time: 90}
]
|> Enum.map(fn zone -> Zone.changeset(%Zone{}, zone) end)
|> Enum.each(fn changeset -> Repo.insert!(changeset) end)


[
  %{address: "Lossi", total_slots: "20", zone_id: 1, pin_lng: DataParser.get_coordinates_by_address("Lossi") |> Map.get("lng"), pin_lat: DataParser.get_coordinates_by_address("Lossi") |> Map.get("lat"), coordinates: %Geo.MultiPoint{coordinates: DataParser.get_coordinates_by_address("Lossi", zone_a_parkings), srid: 4326} },
  %{address: "Karl Ernst von Baeri", total_slots: "20", zone_id: 1, pin_lng: DataParser.get_coordinates_by_address("Karl Ernst von Baeri") |> Map.get("lng"), pin_lat: DataParser.get_coordinates_by_address("Karl Ernst von Baeri") |> Map.get("lat"), coordinates: %Geo.MultiPoint{coordinates: DataParser.get_coordinates_by_address("Karl Ernst von Baeri", zone_a_parkings), srid: 4326} },
  %{address: "Vallikraavi", total_slots: "20", zone_id: 1, pin_lng: DataParser.get_coordinates_by_address("Vallikraavi") |> Map.get("lng"), pin_lat: DataParser.get_coordinates_by_address("Vallikraavi") |> Map.get("lat"), coordinates: %Geo.MultiPoint{coordinates: DataParser.get_coordinates_by_address("Vallikraavi", zone_a_parkings), srid: 4326} },

  %{address: "Juhan Liivi", total_slots: "20", zone_id: 2, pin_lng: DataParser.get_coordinates_by_address("Juhan Liivi") |> Map.get("lng"), pin_lat: DataParser.get_coordinates_by_address("Juhan Liivi") |> Map.get("lat"), coordinates: %Geo.MultiPoint{coordinates: DataParser.get_coordinates_by_address("Juhan Liivi", zone_b_parkings), srid: 4326} }
]
|> Enum.map(fn parking -> Parking.changeset(%Parking{}, parking) end)
|> Enum.each(fn changeset -> Repo.insert!(changeset) end)


[
  %{name: "User", username: "user", password: "user"},
  %{name: "Admin", username: "admin", password: "admin"}
]
|> Enum.map(fn user -> User.changeset(%User{}, user) end)
|> Enum.each(fn changeset -> Repo.insert!(changeset) end)
