<!DOCTYPE html>
<html>
  <head>
    <title>Elixir.TartuParking.Geolocator</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="css/source.css" type="text/css" media="screen" charset="utf-8" />
    <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>
  </head>

  <body>
    <div id="content">
      <h1>Elixir.TartuParking.Geolocator Coverage Source Code</h1>

      <table class="source">
        <thead>
          <tr>
            <th>Line Number</th><th>Covered Lines</th><th>Source Code</th>
          </tr>
        </thead>
        <tbody>
          <tr class="source"><td class="num"> 1</td>
  <td class="num"></td>
  <td class="elixir">
    
      <a name="#Elixir.TartuParking.Geolocator"></a>
    
    <pre class="irrelevant">defmodule TartuParking.Geolocator do
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 2</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">	@http_client Application.get_env(:tartu_parking, :http_client)
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 3</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">	import Ecto.Query, only: [from: 2]
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 4</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">	alias TartuParking.{Repo,Parking}
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 5</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 6</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 7</td>
  <td class="num"></td>
  <td class="elixir">
    
      <a name="#Elixir.TartuParking.Geolocator.find_closest_parkings.1"></a>
    
    <pre class="irrelevant">	def find_closest_parkings(address) do
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 8</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 9</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">		# Maximum distance between inserted destination and parking places in meters
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 10</td>
  <td class="num">0</td>
  <td class="elixir">
    
    <pre class="not_covered">		max_distance = 5000
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 11</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 12</td>
  <td class="num">0</td>
  <td class="elixir">
    
    <pre class="not_covered">		parkings = Repo.all(Parking)
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 13</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 14</td>
  <td class="num">0</td>
  <td class="elixir">
    
    <pre class="not_covered">		if length(parkings) == 0 do
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 15</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">			[]
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 16</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">		else
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 17</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">			# Join parking places for Distancematrix API
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 18</td>
  <td class="num">0</td>
  <td class="elixir">
    
    <pre class="not_covered">			joined_parking_addresses =
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 19</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">        parkings
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 20</td>
  <td class="num">0</td>
  <td class="elixir">
    
    <pre class="not_covered">			|&gt; Enum.map(fn(parking) -&gt; parking.address &lt;&gt; ", Tartu city, Estonia`" end)
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 21</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">			|&gt; Enum.join("|")
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 22</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 23</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">			# Google Distancematrix API request to get distances for all available parking places
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 24</td>
  <td class="num">0</td>
  <td class="elixir">
    
    <pre class="not_covered">			origin = address &lt;&gt; ", Tartu city, Estonia`"
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 25</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 26</td>
  <td class="num">0</td>
  <td class="elixir">
    
    <pre class="not_covered">			url = URI.encode("http://maps.googleapis.com/maps/api/distancematrix/json?origins=#{origin}&amp;destinations=#{joined_parking_addresses}")
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 27</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 28</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">			# Parse distances
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 29</td>
  <td class="num">0</td>
  <td class="elixir">
    
    <pre class="not_covered">			%{"body": body} = @http_client.get!(url)
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 30</td>
  <td class="num">0</td>
  <td class="elixir">
    
    <pre class="not_covered">			%{"rows" =&gt; rows} = Poison.Parser.parse!(body)
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 31</td>
  <td class="num">0</td>
  <td class="elixir">
    
    <pre class="not_covered">			%{"elements" =&gt; distances} = List.first(rows)
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 32</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 33</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">			# Filter out only parkings in given range
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 34</td>
  <td class="num">0</td>
  <td class="elixir">
    
    <pre class="not_covered">			parkings_in_range =
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 35</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">				Enum.zip(parkings, distances)
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 36</td>
  <td class="num">0</td>
  <td class="elixir">
    
    <pre class="not_covered">				|&gt; Enum.filter(fn(parking) -&gt; parking_is_in_range(parking, max_distance) end)
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 37</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 38</td>
  <td class="num">0</td>
  <td class="elixir">
    
    <pre class="not_covered">			parkings_in_range
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 39</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">		end
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 40</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">	end
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 41</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 42</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 43</td>
  <td class="num"></td>
  <td class="elixir">
    
      <a name="#Elixir.TartuParking.Geolocator.parking_is_in_range.2"></a>
    
    <pre class="irrelevant">	def parking_is_in_range({_parking, distance}, range) do
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 44</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">		# Checks if parking place distance is less than given range
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 45</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 46</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">		distance
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 47</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">		|&gt; Map.fetch("distance")
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 48</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">		|&gt; elem(1)
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 49</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">		|&gt; Map.fetch("value")
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 50</td>
  <td class="num">0</td>
  <td class="elixir">
    
    <pre class="not_covered">		|&gt; elem(1) &lt; range
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 51</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">	end
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 52</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">
</pre>
  </td>
</tr>
<tr class="source"><td class="num"> 53</td>
  <td class="num"></td>
  <td class="elixir">
    
    <pre class="irrelevant">end</pre>
  </td>
</tr>

        </tbody>
      </table>
    </div>
  </body>
</html>
